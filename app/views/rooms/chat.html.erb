<h1>
  対戦チャットルーム
  <% if @room.status == 3 || @room.status == 5 %>
    ログ（メッセージ送信不可）
  <% end %>
</h1>

<div class="chat">
  <div class="chat-messages">
    <% @messages.each do |message| %>
      <%= attachment_image_tag message.end_user, :image, fallback: "no-user-image-icon.jpg", size: "60x60" %>
      <%= message.end_user.name %>
      <% if message.is_deleted %>
        このメッセージは削除されました
      <% else %>
        <%= message.content %>
        <%= link_to '削除', message_path(message), method: :patch %>
      <% end %> <br />
    <% end %>
  </div>
  <div class="send-message">
    <%= form_with model: @messsage, url: messages_path, method: :post, local: true do |f| %>
      <div class="form-group row">
        <%= f.label :メッセージ, class: "col-md-1" %>
        <%= f.text_area :content, class: "form-control col-md-8" %>
      </div>
      <div>
        <%= f.hidden_field :room_id, :value => @room.id %>
        <%= f.hidden_field :end_user_id, :value => current_end_user.id %>
      </div>
      <div class="form-group col-md-12 text-center">
        <%= f.submit "送信", class: 'btn btn-success' %>
      </div>
    <% end %>
  </div>
</div>

<div class="finishing">
  <% if @room.status == 2 %>
    <% case @room.finishing %>
    <% when 0 %>
      <%= link_to '終了希望', finish_room_path(@room), method: :post %>
    <% when current_end_user.id %>
      <%= link_to '終了希望キャンセル', finish_room_path(@room), method: :post %>
    <% else %>
      <%= link_to '終了希望に同意', finish_room_path(@room), method: :post %>
    <% end %>
    | <%= link_to '中断', accept_room_path(@room), method: :post %>
  <% end %>
</div>